<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Playing Spots Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="header">
            <h1>Chess Playing Spots Around the World</h1>
            <div class="filter-container">
                <label for="cityFilter">City / Country:</label>
                <input type="text" id="cityFilter" placeholder="Type city or country">
                <label for="typeFilter">Place Type:</label>
                <select id="typeFilter">
                    <option value="">Select Type</option>
                </select>
                <button onclick="applyFilter()">Search</button>
            </div>
        </div>
        <ul id="clubList"></ul>
    </div>
    <div id="map"></div>

    <script>
        var map = L.map('map').setView([48.8566, 2.3522], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);

        var markers = [];
        var typeLogos = {
            "Chess Club": "https://i.imgur.com/96rCMOK.png",
            "Chess Park": "https://i.imgur.com/lujRXd5.png",
            "Chess Cafe": "https://i.imgur.com/Pzgo8PH.png"
        };
        var cityCountrySet = new Set(); // Set to store unique city and country names

        fetch('chess_spots.json')
            .then(response => response.json())
            .then(data => {
                data.forEach(spot => {
                    addMarker(spot);
                    cityCountrySet.add(spot.city + ", " + spot.country);
                });
                updateTypeFilter();
                updateAutocomplete();
            });

        function addMarker(spot) {
            var marker = L.marker([spot.lat, spot.lon]).addTo(map);
            marker.bindPopup(getPopupContent(spot));
            markers.push(marker);
            document.getElementById('clubList').appendChild(createListItem(marker, spot));
        }

        function getPopupContent(spot) {
            return `<b>${spot.name}</b><br>
                    <img src="${spot.image || typeLogos[spot.type]}" style="width: 100px;"><br>
                    <b>Location:</b> ${spot.city}, ${spot.country}<br>
                    <b>Type:</b> ${spot.type}<br>
                    <b>Days:</b> ${spot.days}<br>
                    <b>Times:</b> ${spot.times}`;
        }

        function createListItem(marker, spot) {
            var listItem = document.createElement('li');
            listItem.className = 'clickable-item';
            listItem.innerHTML = `<img src="${typeLogos[spot.type]}" class="logo" alt="${spot.type} Logo"><b>${spot.name}</b><br>${spot.city}, ${spot.country}`;
            listItem.onclick = function() {
                map.setView(marker.getLatLng(), 15);
                marker.openPopup();
            };
            return listItem;
        }

        function updateAutocomplete() {
            $("#cityFilter").autocomplete({
                source: Array.from(cityCountrySet)
            });
        }

        function updateTypeFilter() {
            var typeSelect = document.getElementById('typeFilter');
            markers.forEach(marker => {
                if (!typeSelect.innerHTML.includes(marker.options.data.type)) {
                    var option = document.createElement('option');
                    option.value = marker.options.data.type.toLowerCase();
                    option.text = marker.options.data.type;
                    typeSelect.appendChild(option);
                }
            });
        }

        function applyFilter() {
            var cityFilterValue = document.getElementById('cityFilter').value.toLowerCase();
            var typeFilterValue = document.getElementById('typeFilter').value.toLowerCase();
            document.getElementById('clubList').innerHTML = ''; // Clear the list

            markers.forEach(marker => {
                if (marker.getPopup().getContent().toLowerCase().includes(cityFilterValue) &&
                    marker.getPopup().getContent().toLowerCase().includes(typeFilterValue)) {
                    marker.addTo(map);
                    document.getElementById('clubList').appendChild(createListItem(marker, marker.options.data));
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        document.getElementById('cityFilter').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                applyFilter();
            }
        });
        document.getElementById('typeFilter').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                applyFilter();
            }
        });
    </script>
</body>
</html>